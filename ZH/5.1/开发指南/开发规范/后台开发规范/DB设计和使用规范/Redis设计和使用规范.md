## Redis 设计和使用规范

### 1. 命名规范

- 【建议】key名尽量具有可读性，同一类型/模块使用相同的前缀: 如 `igame*`, `dnf*`
- 【建议】key名多个段之间用统一的字符分割，推荐分割符： `_ | : # + = ; ,.`
- 【建议】key名字尽量简短，建议控制在100字节内，不允许超过976字节
- 【建议】key名尽量避免使用二进制
- 【建议】key名不要包含空格/换行/回车/单双引号/tab等特殊字符

### 2. 设计规范

- 【建议】尽量减少大key的设计，string类型控制在10KB以内，hash、list、set、zset元素个数不要超过5000(避免网卡流量瓶颈/慢查询)
- 【建议】单个热点key可以考虑拆分成多个key进行处理，把热度打散
- 【建议】非字符串的bigkey，不要使用del删除，使用hscan、sscan、zscan方式渐进式删除
- 【建议】注意防止bigkey过期时间自动删除问题，而引起阻塞
- 【建议】选择合适的数据类型
- 【建议】控制key的生命周期，尽量都设置expire过期时间，且要避免集中过期
- 【建议】Redis事务功能较弱，不建议过多使用；集群模式下，不支持事务

### 3. 使用规范

- 【建议】合理利用批操作命令，使用O(N)命令(hgetall/lrange/smembers/zrange/sinter)时需关注N的数量，有遍历的需求可以使用hscan/sscan/zscan代替
- 【建议】减少不必要的请求，del 前先 ttl，避免删除不存在的key
- 【必须】禁止线上使用keys/monitor/flushall/flushdb等危险命令，通过Redis的rename机制禁掉，或者使用scan的方式渐进式处理
- 【建议】合理使用select，redis默认使用db0
- 【建议】在必须使用monitor命令时，要注意不要长时间开启

### 4. 客户端规范

- 【建议】避免多个业务使用同一个Redis实例
- 【建议】高并发下建议客户端添加熔断功能，减少到DB侧的压力
- 【必须】客户端必须要使用密码访问Redis，并且避免在公网访问
- 【建议】客户端访问Redis最好带连接池，并且使用长连接，能够减少创建链接的开销
